version: '1.0'

steps:


  install_dependencies:
    title: 'Installing testing dependencies'
    image: codefresh/node-tester-image:9.6.1
    commands:
        - yarn install --frozen-lockfile


  eslint:
    title: 'Running linting logic'
    image: codefresh/node-tester-image:9.6.1
    commands:
        - yarn lint
        - yarn no-onlys

#  unit_test_step:
#    image: codefresh/node-tester-image:9.6.1
#    environment:
#        - COVERALLS_TOKEN=${{COVERALLS_TOKEN}}
#    commands:
#        - yarn test:ci

  build_step:
    title: "Building production image"
    type: build
    image_name: codefresh/cf-container-logger
    on_success:
      metadata:
        set:
          - '${{build_step.imageId}}':
              - CF_QUALITY: true

  push to registry:
    type: push
    candidate: ${{build_step}}
    tag: ${{CF_BRANCH}}
